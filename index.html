<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω SOP Danh m·ª•c Thu·ªëc Nh·∫≠n H√†ng</title>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
    <!-- Th∆∞ vi·ªán SheetJS ƒë·ªÉ ƒë·ªçc Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Th∆∞ vi·ªán jsPDF ƒë·ªÉ xu·∫•t PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #2c5aa0;
            --secondary-color: #e74c3c;
            --accent-color: #27ae60;
            --light-bg: #f8f9fa;
            --border-color: #dee2e6;
            --text-color: #333;
        }
        
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            margin: 0;
            padding: 15px;
            background-color: #f0f2f5;
            color: var(--text-color);
            font-size: 14px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 15px;
        }
        .logo-container {
            width: 120px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .logo {
            max-width: 100%;
            max-height: 100%;
        }
        .company-info {
            flex-grow: 1;
            text-align: center;
            padding: 0 15px;
        }
        .company-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--primary-color);
        }
        .document-title {
            font-size: 20px;
            font-weight: bold;
            margin: 8px 0;
            color: var(--secondary-color);
            text-transform: uppercase;
        }
        .document-code {
            font-size: 14px;
            margin-bottom: 5px;
            color: #6c757d;
        }
        .compact-form-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--light-bg);
        }
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 10px;
            gap: 10px;
        }
        .form-group {
            flex: 1;
            min-width: 180px;
        }
        .compact-form-group {
            flex: 1;
            min-width: 150px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--primary-color);
            font-size: 13px;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 13px;
            transition: all 0.2s;
        }
        input:focus, select:focus, textarea:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(44, 90, 160, 0.1);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 13px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        th, td {
            border: 1px solid var(--border-color);
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
            font-size: 12px;
        }
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        .action-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
        }
        .utility-buttons {
            margin-top: 10px;
            display: flex;
            justify-content: flex-start;
            gap: 8px;
        }
        button {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 5px rgba(0,0,0,0.1);
        }
        .btn-primary {
            background-color: var(--accent-color);
            color: white;
        }
        .btn-primary:hover {
            background-color: #219653;
        }
        .btn-secondary {
            background-color: var(--primary-color);
            color: white;
        }
        .btn-secondary:hover {
            background-color: #1e4a8a;
        }
        .btn-danger {
            background-color: #e74c3c;
            color: white;
        }
        .btn-danger:hover {
            background-color: #c0392b;
        }
        .btn-warning {
            background-color: #f39c12;
            color: white;
        }
        .btn-warning:hover {
            background-color: #d35400;
        }
        .btn-info {
            background-color: #3498db;
            color: white;
        }
        .btn-info:hover {
            background-color: #2980b9;
        }
        .btn-purple {
            background-color: #9b59b6;
            color: white;
        }
        .btn-purple:hover {
            background-color: #8e44ad;
        }
        .hidden {
            display: none;
        }
        .upload-section {
            margin-top: 20px;
            padding: 15px;
            border: 2px dashed #bdc3c7;
            border-radius: 6px;
            background-color: #f8f9fa;
        }
        .receiving-info {
            margin-top: 15px;
            padding: 12px;
            background-color: #ecf0f1;
            border-radius: 5px;
        }
        .receiving-info-row {
            display: flex;
            margin-bottom: 8px;
            align-items: center;
        }
        .receiving-info-label {
            min-width: 180px;
            font-weight: 600;
            color: var(--primary-color);
            font-size: 13px;
        }
        .receiving-info-input {
            flex-grow: 1;
            padding: 6px 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background-color: white;
            font-size: 13px;
        }
        .signature-section {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
        }
        .signature-box {
            text-align: center;
            width: 200px;
        }
        .signature-line {
            border-top: 1px solid var(--text-color);
            margin-top: 40px;
            padding-top: 5px;
            font-weight: 600;
        }
        .pdf-options {
            margin-top: 15px;
            padding: 12px;
            background-color: #f9f9f9;
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }
        .pdf-options label {
            display: inline-block;
            margin-right: 15px;
            font-weight: normal;
        }
        .no-print {
            display: block;
        }
        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--border-color);
        }
        .saved-files-section {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: var(--light-bg);
        }
        .files-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 10px;
            background-color: white;
        }
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid var(--border-color);
        }
        .file-item:last-child {
            border-bottom: none;
        }
        .file-info {
            flex-grow: 1;
        }
        .file-name {
            font-weight: 600;
            color: var(--primary-color);
        }
        .file-date {
            font-size: 12px;
            color: #6c757d;
        }
        .file-actions {
            display: flex;
            gap: 5px;
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .status-online {
            background-color: var(--accent-color);
        }
        .status-offline {
            background-color: #e74c3c;
        }
        @media print {
            .no-print, .no-print * {
                display: none !important;
            }
            body {
                padding: 0;
                background-color: white;
            }
            .container {
                box-shadow: none;
                padding: 10px;
                max-width: 100%;
            }
            table {
                font-size: 12px;
            }
            th, td {
                padding: 6px;
            }
        }
        .alert {
            padding: 10px;
            border-radius: 4px;
            margin: 8px 0;
            font-size: 13px;
        }
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .compact-table {
            font-size: 12px;
        }
        .compact-table th, 
        .compact-table td {
            padding: 6px 4px;
        }
        .compact-table input, 
        .compact-table select {
            padding: 4px 6px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container" id="contentToPrint">
        <div class="header">
            <div class="logo-container">
                <img src="https://cdn.imgpile.com/f/ZMtwhK9_xl.png" alt="Logo c√¥ng ty" class="logo">
            </div>
            <div class="company-info">
                <div class="company-name">C√îNG TY TNHH TM DV K·∫æT GIAO PH√ÅT TRI·ªÇN QU·ªêC T·∫æ IDECO</div>
                <div class="document-title">BI√äN B·∫¢N NH·∫¨N H√ÄNG</div>
                <div class="document-code">BMI.06</div>
            </div>
            <div class="logo-container" style="visibility: hidden;">
                <!-- Placeholder for alignment -->
            </div>
        </div>

        <div id="connectionStatus" class="alert" style="display: none;">
            <span class="status-indicator status-offline"></span>
            <span id="statusText">ƒêang k·∫øt n·ªëi v·ªõi Firebase...</span>
        </div>

        <div class="compact-form-section">
            <div class="section-title">Th√¥ng tin nh·∫≠n h√†ng</div>
            <div class="form-row">
                <div class="compact-form-group">
                    <label for="supplierName">T√™n nh√† cung c·∫•p</label>
                    <input type="text" id="supplierName">
                </div>
                <div class="compact-form-group">
                    <label for="invoiceNumber">H√≥a ƒë∆°n</label>
                    <input type="text" id="invoiceNumber">
                </div>
                <div class="compact-form-group">
                    <label for="contractNumber">S·ªë h·ª£p ƒë·ªìng</label>
                    <input type="text" id="contractNumber">
                </div>
            </div>
            <div class="form-row">
                <div class="compact-form-group">
                    <label for="receivingPlace">N∆°i nh·∫≠n h√†ng</label>
                    <input type="text" id="receivingPlace" value="003 Carlion 5 262/3 L≈©y B√°n B√≠ch - Ph∆∞·ªùng T√¢n Ph√∫ -Tp. H·ªì Ch√≠ Minh">
                </div>
                <div class="compact-form-group">
                    <label for="receivingDate">Ng√†y nh·∫≠n</label>
                    <input type="date" id="receivingDate">
                </div>
                <div class="compact-form-group">
                    <label for="receivingTime">Gi·ªù nh·∫≠n</label>
                    <input type="time" id="receivingTime">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="inspectionResult">K·∫øt qu·∫£ ki·ªÉm nghi·ªám</label>
                    <textarea id="inspectionResult" rows="2"></textarea>
                </div>
            </div>
        </div>

        <div class="compact-form-section">
            <div class="section-title">Danh m·ª•c thu·ªëc nh·∫≠n h√†ng</div>
            <table id="productTable" class="compact-table">
                <thead>
                    <tr>
                        <th width="4%">STT</th>
                        <th width="18%">T√™n h√†ng</th>
                        <th width="8%">ƒê∆°n v·ªã t√≠nh</th>
                        <th width="10%">S·ªë L√¥</th>
                        <th width="10%">H·∫°n s·ª≠ d·ª•ng</th>
                        <th width="8%">S·ªë l∆∞·ª£ng<br>Th·ª±c t·∫ø</th>
                        <th width="7%">Th·ª´a</th>
                        <th width="7%">Thi·∫øu</th>
                        <th width="7%">H∆∞ h·ªèng</th>
                        <th width="10%">T√¨nh tr·∫°ng</th>
                        <th width="8%">Ghi ch√∫</th>
                        <th width="5%" class="no-print">Thao t√°c</th>
                    </tr>
                </thead>
                <tbody id="productTableBody">
                    <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
                </tbody>
            </table>
            <button type="button" id="addProductBtn" class="btn-secondary no-print" style="margin-top: 10px;">
                <span>+</span> Th√™m s·∫£n ph·∫©m
            </button>
        </div>

        <div class="receiving-info">
            <div class="receiving-info-row">
                <div class="receiving-info-label">Giao nh·∫≠n v·∫≠n chuy·ªÉn:</div>
                <input type="text" class="receiving-info-input" id="deliveryTransport" placeholder="Nh·∫≠p th√¥ng tin giao nh·∫≠n v·∫≠n chuy·ªÉn...">
            </div>
            <div class="receiving-info-row">
                <div class="receiving-info-label">ƒêi·ªÅu ki·ªán thanh to√°n:</div>
                <input type="text" class="receiving-info-input" id="paymentCondition" placeholder="Nh·∫≠p ƒëi·ªÅu ki·ªán thanh to√°n...">
            </div>
            <div class="receiving-info-row">
                <div class="receiving-info-label">C√°c y√™u c·∫ßu kh√°c:</div>
                <input type="text" class="receiving-info-input" id="otherRequirements" placeholder="Nh·∫≠p c√°c y√™u c·∫ßu kh√°c...">
            </div>
        </div>

        <div class="signature-section">
            <div></div> <!-- Empty div for alignment -->
            <div class="signature-box">
                <div class="signature-line">Ng∆∞·ªùi l·∫≠p bi√™n b·∫£n</div>
                <input type="text" id="preparerName" placeholder="H·ªç t√™n" style="width: 100%; margin-top: 5px; text-align: center; border: none; border-bottom: 1px dashed #ccc; background: transparent; outline: none;">
            </div>
            <div class="signature-box">
                <div class="signature-line">B·ªô ph·∫≠n Kho</div>
                <input type="text" id="warehouseStaffName" placeholder="H·ªç t√™n" style="width: 100%; margin-top: 5px; text-align: center; border: none; border-bottom: 1px dashed #ccc; background: transparent; outline: none;">
            </div>
        </div>

        <div class="saved-files-section no-print">
            <div class="section-title">Danh s√°ch file PDF ƒë√£ l∆∞u</div>
            <div class="files-list" id="filesList">
                <div class="file-item">
                    <div class="file-info">
                        <div class="file-name">ƒêang t·∫£i danh s√°ch...</div>
                    </div>
                </div>
            </div>
            <p style="font-size: 12px; color: #6c757d; margin-top: 8px;">
                <strong>L∆∞u √Ω:</strong> T·ªëi ƒëa 10 file g·∫ßn nh·∫•t s·∫Ω ƒë∆∞·ª£c l∆∞u tr·ªØ. C√°c file c≈© h∆°n s·∫Ω t·ª± ƒë·ªông b·ªã x√≥a.
            </p>
        </div>

        <div class="upload-section no-print">
            <div class="section-title">Upload d·ªØ li·ªáu t·ª´ Excel</div>
            <div class="form-row">
                <div class="form-group">
                    <label for="dataFile">Ch·ªçn file Excel (.xlsx, .xls)</label>
                    <input type="file" id="dataFile" accept=".xlsx,.xls">
                </div>
            </div>
            <p style="font-size: 13px; margin: 8px 0;"><strong>ƒê·ªãnh d·∫°ng file Excel h·ªó tr·ª£:</strong></p>
            <p style="font-size: 13px; margin: 5px 0;">File c·ªßa b·∫°n c·∫ßn c√≥ c√°c c·ªôt: STT, T√™n H√†ng H√≥a, ƒê∆°n V·ªã, T·ªïng S·ªë L∆∞·ª£ng, S·ªë L√¥, H·∫°n D√πng</p>
            <p style="font-size: 13px; margin: 5px 0;"><strong>L∆∞u √Ω:</strong> C√°c c·ªôt c√≤n l·∫°i s·∫Ω ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng ƒë·ªÉ nh·∫≠p th·ªß c√¥ng</p>
            <div id="uploadMessage"></div>
        </div>

        <div class="utility-buttons no-print">
            <button type="button" id="cameraAiBtn" class="btn-purple" onclick="openCameraAI()">
                üì∑ Ch·ª•pAI
            </button>
            <button type="button" id="erpHomeBtn" class="btn-purple" onclick="openERPHome()">
                üè† ERP HOME
            </button>
        </div>

        <div class="action-buttons no-print">
            <button type="button" id="saveBtn" class="btn-primary">
                üíæ L∆∞u & T·∫°o PDF
            </button>
            <button type="button" id="exportExcelBtn" class="btn-info">
                üìä Xu·∫•t Excel
            </button>
            <button type="button" id="exportPdfBtn" class="btn-warning">
                üìÑ Xu·∫•t PDF
            </button>
            <button type="button" id="printBtn" class="btn-secondary">
                üñ®Ô∏è In
            </button>
            <button type="button" id="resetBtn" class="btn-danger">
                üîÑ L√†m m·ªõi
            </button>
        </div>

        <div class="pdf-options no-print" id="pdfOptions" style="display: none;">
            <h4 style="margin-top: 0; font-size: 14px;">T√πy ch·ªçn xu·∫•t PDF:</h4>
            <label>
                <input type="radio" name="pageOrientation" value="portrait" checked> Kh·ªï d·ªçc (A4)
            </label>
            <label>
                <input type="radio" name="pageOrientation" value="landscape"> Kh·ªï ngang (A4)
            </label>
            <button type="button" id="confirmExportPdf" class="btn-primary" style="margin-left: 10px;">X√°c nh·∫≠n xu·∫•t PDF</button>
            <button type="button" id="cancelExportPdf" class="btn-danger" style="margin-left: 5px;">H·ªßy</button>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCM_gZ1DEOtUwB0Ii-dm-6jIpxydoJU4-E",
            authDomain: "dulieuthuoc-d532e.firebaseapp.com",
            projectId: "dulieuthuoc-d532e",
            storageBucket: "dulieuthuoc-d532e.firebasestorage.app",
            messagingSenderId: "70002622120",
            appId: "1:70002622120:web:9676e1616a0774bae28c9d",
            measurementId: "G-LQ5P054T97"
        };

        // Initialize Firebase
        let db, storage;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            storage = firebase.storage();
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.error("Firebase initialization error:", error);
        }

        // H√†m m·ªü Ch·ª•pAI
        function openCameraAI() {
            window.open('https://idecochupanh.netlify.app', '_blank');
        }

        // H√†m m·ªü ERP HOME
        function openERPHome() {
            window.open('https://erp-ideco.skyit.vn/#/app/dashboard/main', '_blank');
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Hi·ªÉn th·ªã tr·∫°ng th√°i k·∫øt n·ªëi
            const connectionStatus = document.getElementById('connectionStatus');
            const statusText = document.getElementById('statusText');
            
            // Ki·ªÉm tra k·∫øt n·ªëi Firebase
            if (db) {
                db.enableNetwork().then(() => {
                    connectionStatus.style.display = 'block';
                    connectionStatus.className = 'alert alert-success';
                    statusText.innerHTML = '<span class="status-indicator status-online"></span> ƒê√£ k·∫øt n·ªëi v·ªõi Firebase - D·ªØ li·ªáu realtime';
                }).catch((error) => {
                    connectionStatus.style.display = 'block';
                    connectionStatus.className = 'alert alert-error';
                    statusText.innerHTML = '<span class="status-indicator status-offline"></span> L·ªói k·∫øt n·ªëi Firebase: ' + error.message;
                });
            } else {
                connectionStatus.style.display = 'block';
                connectionStatus.className = 'alert alert-error';
                statusText.innerHTML = '<span class="status-indicator status-offline"></span> Kh√¥ng th·ªÉ k·∫øt n·ªëi v·ªõi Firebase';
            }

            // X·ª≠ l√Ω th√™m s·∫£n ph·∫©m
            const addProductBtn = document.getElementById('addProductBtn');
            const productTableBody = document.getElementById('productTableBody');
            const uploadMessage = document.getElementById('uploadMessage');
            let productCount = 0;
            
            // T·∫£i d·ªØ li·ªáu ƒë√£ l∆∞u t·ª´ Firebase
            loadDataFromFirebase();
            // T·∫£i danh s√°ch file PDF
            loadSavedFiles();
            
            addProductBtn.addEventListener('click', function() {
                addNewProductRow();
            });
            
            function showMessage(message, type = 'success') {
                uploadMessage.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
                setTimeout(() => {
                    uploadMessage.innerHTML = '';
                }, 5000);
            }
            
            function addNewProductRow(productData = {}) {
                productCount++;
                const newRow = document.createElement('tr');
                newRow.innerHTML = `
                    <td>${productCount}</td>
                    <td><input type="text" name="productName" value="${productData['T√™n H√†ng H√≥a'] || productData['T√™n h√†ng'] || ''}"></td>
                    <td><input type="text" name="unit" value="${productData['ƒê∆°n V·ªã'] || productData['ƒê∆°n v·ªã t√≠nh'] || 'H·ªôp'}"></td>
                    <td><input type="text" name="lotNumber" value="${productData['S·ªë L√¥'] || productData['S·ªë l√¥'] || ''}"></td>
                    <td><input type="date" name="expiryDate" value="${formatDateForInput(productData['H·∫°n D√πng'] || productData['H·∫°n s·ª≠ d·ª•ng'] || '')}"></td>
                    <td><input type="number" name="actualQuantity" min="0" value="${productData['T·ªïng S·ªë L∆∞·ª£ng'] || productData['S·ªë l∆∞·ª£ng'] || ''}"></td>
                    <td><input type="number" name="excessQuantity" min="0" value="0"></td>
                    <td><input type="number" name="shortageQuantity" min="0" value="0"></td>
                    <td><input type="number" name="damagedQuantity" min="0" value="0"></td>
                    <td>
                        <select name="packageCondition">
                            <option value="Nguy√™n ven">Nguy√™n ven</option>
                            <option value="H∆∞ h·ªèng nh·∫π">H∆∞ h·ªèng nh·∫π</option>
                            <option value="H∆∞ h·ªèng n·∫∑ng">H∆∞ h·ªèng n·∫∑ng</option>
                        </select>
                    </td>
                    <td><input type="text" name="note"></td>
                    <td class="no-print"><button type="button" class="btn-danger remove-product" style="padding: 4px 8px; font-size: 11px;">X√≥a</button></td>
                `;
                
                productTableBody.appendChild(newRow);
                
                // X·ª≠ l√Ω s·ª± ki·ªán x√≥a s·∫£n ph·∫©m
                newRow.querySelector('.remove-product').addEventListener('click', function() {
                    productTableBody.removeChild(newRow);
                    updateRowNumbers();
                    saveDataToFirebase(); // ƒê·ªìng b·ªô sau khi x√≥a
                });
            }
            
            // H√†m chuy·ªÉn ƒë·ªïi ƒë·ªãnh d·∫°ng ng√†y t·ª´ dd/mm/yyyy sang yyyy-mm-dd
            function formatDateForInput(dateString) {
                if (!dateString) return '';
                
                // N·∫øu ƒë√£ l√† ƒë·ªãnh d·∫°ng yyyy-mm-dd th√¨ gi·ªØ nguy√™n
                if (/^\d{4}-\d{2}-\d{2}$/.test(dateString)) {
                    return dateString;
                }
                
                // Chuy·ªÉn ƒë·ªïi t·ª´ dd/mm/yyyy sang yyyy-mm-dd
                const parts = dateString.split('/');
                if (parts.length === 3) {
                    const day = parts[0].padStart(2, '0');
                    const month = parts[1].padStart(2, '0');
                    const year = parts[2];
                    return `${year}-${month}-${day}`;
                }
                
                return dateString;
            }
            
            // C·∫≠p nh·∫≠t s·ªë th·ª© t·ª± c√°c d√≤ng
            function updateRowNumbers() {
                const rows = productTableBody.querySelectorAll('tr');
                productCount = 0;
                rows.forEach(row => {
                    productCount++;
                    row.cells[0].textContent = productCount;
                });
            }
            
            // L∆∞u d·ªØ li·ªáu l√™n Firebase
            function saveDataToFirebase() {
                if (!db) {
                    showMessage('Kh√¥ng th·ªÉ k·∫øt n·ªëi v·ªõi Firebase', 'error');
                    return;
                }
                
                const formData = collectFormData();
                
                db.collection('deliveryRecords').doc('current').set(formData)
                    .then(() => {
                        console.log('D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c l∆∞u l√™n Firebase');
                    })
                    .catch((error) => {
                        console.error('L·ªói khi l∆∞u d·ªØ li·ªáu l√™n Firebase:', error);
                        showMessage('L·ªói khi l∆∞u d·ªØ li·ªáu l√™n Firebase', 'error');
                    });
            }
            
            // T·∫£i d·ªØ li·ªáu t·ª´ Firebase
            function loadDataFromFirebase() {
                if (!db) return;
                
                db.collection('deliveryRecords').doc('current').onSnapshot((doc) => {
                    if (doc.exists) {
                        const formData = doc.data();
                        populateFormData(formData);
                        showMessage('D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c ƒë·ªìng b·ªô t·ª´ Firebase', 'success');
                    }
                }, (error) => {
                    console.error('L·ªói khi t·∫£i d·ªØ li·ªáu t·ª´ Firebase:', error);
                });
            }
            
            // Thu th·∫≠p d·ªØ li·ªáu t·ª´ form
            function collectFormData() {
                return {
                    deliveryInfo: {
                        supplier: document.getElementById('supplierName').value,
                        invoice: document.getElementById('invoiceNumber').value,
                        contract: document.getElementById('contractNumber').value,
                        place: document.getElementById('receivingPlace').value,
                        date: document.getElementById('receivingDate').value,
                        time: document.getElementById('receivingTime').value,
                        inspection: document.getElementById('inspectionResult').value,
                        deliveryTransport: document.getElementById('deliveryTransport').value,
                        paymentCondition: document.getElementById('paymentCondition').value,
                        otherRequirements: document.getElementById('otherRequirements').value,
                        preparerName: document.getElementById('preparerName').value,
                        warehouseStaffName: document.getElementById('warehouseStaffName').value
                    },
                    products: []
                };
            }
            
            // ƒêi·ªÅn d·ªØ li·ªáu v√†o form
            function populateFormData(formData) {
                if (!formData.deliveryInfo) return;
                
                document.getElementById('supplierName').value = formData.deliveryInfo.supplier || '';
                document.getElementById('invoiceNumber').value = formData.deliveryInfo.invoice || '';
                document.getElementById('contractNumber').value = formData.deliveryInfo.contract || '';
                document.getElementById('receivingPlace').value = formData.deliveryInfo.place || '003 Carlion 5 262/3 L≈©y B√°n B√≠ch - Ph∆∞·ªùng T√¢n Ph√∫ -Tp. H·ªì Ch√≠ Minh';
                document.getElementById('receivingDate').value = formData.deliveryInfo.date || '';
                document.getElementById('receivingTime').value = formData.deliveryInfo.time || '';
                document.getElementById('inspectionResult').value = formData.deliveryInfo.inspection || '';
                document.getElementById('deliveryTransport').value = formData.deliveryInfo.deliveryTransport || '';
                document.getElementById('paymentCondition').value = formData.deliveryInfo.paymentCondition || '';
                document.getElementById('otherRequirements').value = formData.deliveryInfo.otherRequirements || '';
                document.getElementById('preparerName').value = formData.deliveryInfo.preparerName || '';
                document.getElementById('warehouseStaffName').value = formData.deliveryInfo.warehouseStaffName || '';
                
                // X√≥a d·ªØ li·ªáu c≈© v√† th√™m s·∫£n ph·∫©m
                productTableBody.innerHTML = '';
                productCount = 0;
                
                if (formData.products && formData.products.length > 0) {
                    formData.products.forEach(product => {
                        addNewProductRow(product);
                    });
                }
            }
            
            // T·∫£i danh s√°ch file PDF ƒë√£ l∆∞u
            function loadSavedFiles() {
                if (!db) return;
                
                db.collection('savedPdfs')
                    .orderBy('createdAt', 'desc')
                    .limit(10)
                    .onSnapshot((snapshot) => {
                        const filesList = document.getElementById('filesList');
                        filesList.innerHTML = '';
                        
                        if (snapshot.empty) {
                            filesList.innerHTML = '<div class="file-item"><div class="file-info"><div class="file-name">Ch∆∞a c√≥ file n√†o ƒë∆∞·ª£c l∆∞u</div></div></div>';
                            return;
                        }
                        
                        snapshot.forEach((doc) => {
                            const fileData = doc.data();
                            const fileItem = document.createElement('div');
                            fileItem.className = 'file-item';
                            fileItem.innerHTML = `
                                <div class="file-info">
                                    <div class="file-name">${fileData.fileName}</div>
                                    <div class="file-date">${new Date(fileData.createdAt).toLocaleString('vi-VN')}</div>
                                </div>
                                <div class="file-actions">
                                    <button class="btn-secondary download-pdf" data-url="${fileData.downloadURL}" style="padding: 4px 8px; font-size: 11px;">T·∫£i v·ªÅ</button>
                                </div>
                            `;
                            filesList.appendChild(fileItem);
                        });
                        
                        // Th√™m s·ª± ki·ªán cho n√∫t t·∫£i v·ªÅ
                        document.querySelectorAll('.download-pdf').forEach(button => {
                            button.addEventListener('click', function() {
                                const url = this.getAttribute('data-url');
                                window.open(url, '_blank');
                            });
                        });
                    });
            }
            
            // L∆∞u file PDF l√™n Firebase Storage
            function savePdfToFirebase(pdfBlob, fileName) {
                if (!storage || !db) {
                    showMessage('Kh√¥ng th·ªÉ k·∫øt n·ªëi v·ªõi Firebase', 'error');
                    return;
                }
                
                const storageRef = storage.ref();
                const pdfRef = storageRef.child(`pdfs/${fileName}`);
                
                pdfRef.put(pdfBlob).then((snapshot) => {
                    return snapshot.ref.getDownloadURL();
                }).then((downloadURL) => {
                    // L∆∞u th√¥ng tin file v√†o Firestore
                    return db.collection('savedPdfs').add({
                        fileName: fileName,
                        downloadURL: downloadURL,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }).then(() => {
                    showMessage('PDF ƒë√£ ƒë∆∞·ª£c l∆∞u l√™n Firebase th√†nh c√¥ng!', 'success');
                }).catch((error) => {
                    console.error('L·ªói khi l∆∞u PDF:', error);
                    showMessage('L·ªói khi l∆∞u PDF l√™n Firebase', 'error');
                });
            }
            
            // X·ª≠ l√Ω upload file Excel
            const dataFileInput = document.getElementById('dataFile');
            
            dataFileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });
                            
                            // L·∫•y sheet ƒë·∫ßu ti√™n
                            const firstSheetName = workbook.SheetNames[0];
                            const worksheet = workbook.Sheets[firstSheetName];
                            
                            // Chuy·ªÉn ƒë·ªïi sheet th√†nh JSON
                            const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                            
                            // T√¨m h√†ng ch·ª©a ti√™u ƒë·ªÅ
                            let headerRowIndex = -1;
                            let headerRow = [];
                            
                            for (let i = 0; i < jsonData.length; i++) {
                                const row = jsonData[i];
                                if (row && row.includes('STT') && (row.includes('T√™n H√†ng H√≥a') || row.includes('T√™n h√†ng'))) {
                                    headerRowIndex = i;
                                    headerRow = row;
                                    break;
                                }
                            }
                            
                            if (headerRowIndex === -1) {
                                showMessage('Kh√¥ng t√¨m th·∫•y h√†ng ti√™u ƒë·ªÅ trong file Excel!', 'error');
                                return;
                            }
                            
                            // T·∫°o mapping t·ª´ ti√™u ƒë·ªÅ sang t√™n c·ªôt
                            const columnMapping = {};
                            headerRow.forEach((header, index) => {
                                if (header) {
                                    columnMapping[header] = index;
                                }
                            });
                            
                            // X√≥a d·ªØ li·ªáu c≈©
                            productTableBody.innerHTML = '';
                            productCount = 0;
                            
                            // Th√™m d·ªØ li·ªáu m·ªõi t·ª´ Excel (b·∫Øt ƒë·∫ßu t·ª´ h√†ng sau header)
                            let importedCount = 0;
                            for (let i = headerRowIndex + 1; i < jsonData.length; i++) {
                                const row = jsonData[i];
                                if (row && row.length > 0 && row[0] !== undefined && row[0] !== '') {
                                    const productData = {};
                                    
                                    // √Ånh x·∫° d·ªØ li·ªáu t·ª´ c·ªôt theo ti√™u ƒë·ªÅ
                                    Object.keys(columnMapping).forEach(header => {
                                        const colIndex = columnMapping[header];
                                        if (colIndex < row.length) {
                                            productData[header] = row[colIndex];
                                        }
                                    });
                                    
                                    addNewProductRow(productData);
                                    importedCount++;
                                }
                            }
                            
                            showMessage(`ƒê√£ t·∫£i l√™n ${importedCount} s·∫£n ph·∫©m t·ª´ file Excel!`, 'success');
                            saveDataToFirebase(); // ƒê·ªìng b·ªô sau khi import
                            
                        } catch (error) {
                            console.error('L·ªói khi ƒë·ªçc file Excel:', error);
                            showMessage('L·ªói khi ƒë·ªçc file Excel: ' + error.message, 'error');
                        }
                    };
                    reader.readAsArrayBuffer(file);
                }
            });
            
            // X·ª≠ l√Ω l∆∞u bi√™n b·∫£n v√† t·∫°o PDF
            document.getElementById('saveBtn').addEventListener('click', function() {
                saveDataAndCreatePDF();
            });
            
            function saveDataAndCreatePDF() {
                // L∆∞u d·ªØ li·ªáu l√™n Firebase
                saveDataToFirebase();
                
                // T·∫°o PDF v√† l∆∞u l√™n Firebase
                createAndSavePDF();
            }
            
            function createAndSavePDF() {
                // ·∫®n c√°c n√∫t khi t·∫°o PDF
                const noPrintElements = document.querySelectorAll('.no-print');
                noPrintElements.forEach(el => {
                    el.style.display = 'none';
                });
                
                // T·∫°o PDF m·ªõi
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });
                
                // L·∫•y n·ªôi dung HTML ƒë·ªÉ chuy·ªÉn ƒë·ªïi
                const element = document.getElementById('contentToPrint');
                
                // S·ª≠ d·ª•ng html2canvas ƒë·ªÉ ch·ª•p n·ªôi dung
                html2canvas(element, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    width: element.scrollWidth,
                    height: element.scrollHeight
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    
                    // T√≠nh to√°n k√≠ch th∆∞·ªõc cho PDF
                    const imgWidth = doc.internal.pageSize.getWidth();
                    const pageHeight = doc.internal.pageSize.getHeight();
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    let heightLeft = imgHeight;
                    let position = 0;
                    
                    // Th√™m trang ƒë·∫ßu ti√™n
                    doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                    
                    // Th√™m c√°c trang ti·∫øp theo n·∫øu n·ªôi dung qu√° d√†i
                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight;
                        doc.addPage();
                        doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }
                    
                    // T·∫°o t√™n file
                    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                    const fileName = `Bien-ban-nhan-hang-${timestamp}.pdf`;
                    
                    // L∆∞u file PDF l√™n Firebase
                    const pdfBlob = doc.output('blob');
                    savePdfToFirebase(pdfBlob, fileName);
                    
                    // T·∫£i v·ªÅ local
                    doc.save(fileName);
                    
                    // Hi·ªÉn th·ªã l·∫°i c√°c n√∫t
                    noPrintElements.forEach(el => {
                        el.style.display = '';
                    });
                });
            }
            
            // X·ª≠ l√Ω xu·∫•t Excel
          // X·ª≠ l√Ω xu·∫•t Excel
document.getElementById('exportExcelBtn').addEventListener('click', function() {
    exportToExcel();
});

function exportToExcel() {
    // T·∫°o workbook m·ªõi
    const wb = XLSX.utils.book_new();
    
    // === D·ªÆ LI·ªÜU CHO 1 SHEET DUY NH·∫§T ===
    const excelData = [
        // Ti√™u ƒë·ªÅ bi√™n b·∫£n
        ['BI√äN B·∫¢N NH·∫¨N H√ÄNG - C√îNG TY TNHH TM DV K·∫æT GIAO PH√ÅT TRI·ªÇN QU·ªêC T·∫æ IDECO'],
        ['M√£ bi√™n b·∫£n: BMI.06', '', '', '', '', '', `Ng√†y xu·∫•t: ${new Date().toLocaleDateString('vi-VN')}`],
        [''],
        
        // Th√¥ng tin nh·∫≠n h√†ng
        ['TH√îNG TIN NH·∫¨N H√ÄNG'],
        ['T√™n nh√† cung c·∫•p:', document.getElementById('supplierName').value, '', '', 'H√≥a ƒë∆°n:', document.getElementById('invoiceNumber').value],
        ['S·ªë h·ª£p ƒë·ªìng:', document.getElementById('contractNumber').value, '', '', 'N∆°i nh·∫≠n h√†ng:', document.getElementById('receivingPlace').value],
        ['Ng√†y nh·∫≠n:', document.getElementById('receivingDate').value, '', '', 'Gi·ªù nh·∫≠n:', document.getElementById('receivingTime').value],
        ['K·∫øt qu·∫£ ki·ªÉm nghi·ªám:', document.getElementById('inspectionResult').value],
        [''],
        
        // Th√¥ng tin giao nh·∫≠n
        ['TH√îNG TIN GIAO NH·∫¨N'],
        ['Giao nh·∫≠n v·∫≠n chuy·ªÉn:', document.getElementById('deliveryTransport').value],
        ['ƒêi·ªÅu ki·ªán thanh to√°n:', document.getElementById('paymentCondition').value],
        ['C√°c y√™u c·∫ßu kh√°c:', document.getElementById('otherRequirements').value],
        [''],
        
        // Ti√™u ƒë·ªÅ b·∫£ng s·∫£n ph·∫©m
        ['DANH M·ª§C THU·ªêC NH·∫¨N H√ÄNG'],
        ['STT', 'T√™n h√†ng', 'ƒê∆°n v·ªã t√≠nh', 'S·ªë L√¥', 'H·∫°n s·ª≠ d·ª•ng', 'S·ªë l∆∞·ª£ng Th·ª±c t·∫ø', 'Th·ª´a', 'Thi·∫øu', 'H∆∞ h·ªèng', 'T√¨nh tr·∫°ng', 'Ghi ch√∫']
    ];
    
    // D·ªØ li·ªáu s·∫£n ph·∫©m
    const productRows = productTableBody.querySelectorAll('tr');
    productRows.forEach(row => {
        const productRow = [
            row.cells[0].textContent,
            row.querySelector('input[name="productName"]').value,
            row.querySelector('input[name="unit"]').value,
            row.querySelector('input[name="lotNumber"]').value,
            row.querySelector('input[name="expiryDate"]').value,
            row.querySelector('input[name="actualQuantity"]').value,
            row.querySelector('input[name="excessQuantity"]').value,
            row.querySelector('input[name="shortageQuantity"]').value,
            row.querySelector('input[name="damagedQuantity"]').value,
            row.querySelector('select[name="packageCondition"]').value,
            row.querySelector('input[name="note"]').value
        ];
        excelData.push(productRow);
    });
    
    // Th√¥ng tin t·ªïng h·ª£p
    excelData.push(['']);
    excelData.push(['T·ªîNG H·ª¢P']);
    excelData.push(['T·ªïng s·ªë s·∫£n ph·∫©m:', productRows.length]);
    excelData.push(['T·ªïng s·ªë l∆∞·ª£ng th·ª±c t·∫ø:', calculateTotal('actualQuantity')]);
    excelData.push(['T·ªïng s·ªë l∆∞·ª£ng th·ª´a:', calculateTotal('excessQuantity')]);
    excelData.push(['T·ªïng s·ªë l∆∞·ª£ng thi·∫øu:', calculateTotal('shortageQuantity')]);
    excelData.push(['T·ªïng s·ªë l∆∞·ª£ng h∆∞ h·ªèng:', calculateTotal('damagedQuantity')]);
    excelData.push(['']);
    
    // Th·ªëng k√™ t√¨nh tr·∫°ng
    excelData.push(['TH·ªêNG K√ä T√åNH TR·∫†NG']);
    const conditionStats = countPackageConditions();
    Object.keys(conditionStats).forEach(condition => {
        excelData.push([condition + ':', conditionStats[condition]]);
    });
    
    excelData.push(['']);
    
    // Th√¥ng tin k√Ω x√°c nh·∫≠n
    excelData.push(['NG∆Ø·ªúI L·∫¨P BI√äN B·∫¢N', '', '', '', '', 'B·ªò PH·∫¨N KHO']);
    excelData.push([document.getElementById('preparerName').value, '', '', '', '', document.getElementById('warehouseStaffName').value]);
    
    // T·∫°o worksheet
    const ws = XLSX.utils.aoa_to_sheet(excelData);
    
    // Thi·∫øt l·∫≠p ƒë·ªô r·ªông c·ªôt (t√πy ch·ªçn)
    const colWidths = [
        { wch: 5 },  // STT
        { wch: 25 }, // T√™n h√†ng
        { wch: 10 }, // ƒê∆°n v·ªã t√≠nh
        { wch: 12 }, // S·ªë L√¥
        { wch: 12 }, // H·∫°n s·ª≠ d·ª•ng
        { wch: 10 }, // S·ªë l∆∞·ª£ng Th·ª±c t·∫ø
        { wch: 8 },  // Th·ª´a
        { wch: 8 },  // Thi·∫øu
        { wch: 10 }, // H∆∞ h·ªèng
        { wch: 15 }, // T√¨nh tr·∫°ng
        { wch: 15 }  // Ghi ch√∫
    ];
    ws['!cols'] = colWidths;
    
    // Th√™m worksheet v√†o workbook
    XLSX.utils.book_append_sheet(wb, ws, 'Bi√™n b·∫£n nh·∫≠n h√†ng');
    
    // Xu·∫•t file Excel
    const fileName = `Bien-ban-nhan-hang-${formatDateForFileName()}.xlsx`;
    XLSX.writeFile(wb, fileName);
    showMessage('ƒê√£ xu·∫•t file Excel th√†nh c√¥ng v·ªõi ƒë·∫ßy ƒë·ªß th√¥ng tin trong 1 sheet!', 'success');
}

// H√†m t√≠nh t·ªïng s·ªë l∆∞·ª£ng
function calculateTotal(fieldName) {
    let total = 0;
    const productRows = productTableBody.querySelectorAll('tr');
    productRows.forEach(row => {
        const input = row.querySelector(`input[name="${fieldName}"]`);
        if (input && input.value) {
            total += parseInt(input.value) || 0;
        }
    });
    return total;
}

// H√†m th·ªëng k√™ t√¨nh tr·∫°ng ƒë√≥ng g√≥i
function countPackageConditions() {
    const conditions = {};
    const productRows = productTableBody.querySelectorAll('tr');
    
    productRows.forEach(row => {
        const select = row.querySelector('select[name="packageCondition"]');
        if (select) {
            const condition = select.value;
            conditions[condition] = (conditions[condition] || 0) + 1;
        }
    });
    
    return conditions;
}

// H√†m ƒë·ªãnh d·∫°ng ng√†y cho t√™n file
function formatDateForFileName() {
    const now = new Date();
    const year = now.getFullYear();
    const month = String(now.getMonth() + 1).padStart(2, '0');
    const day = String(now.getDate()).padStart(2, '0');
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    
    return `${year}${month}${day}-${hours}${minutes}`;
}
            
            // X·ª≠ l√Ω xu·∫•t PDF
            const exportPdfBtn = document.getElementById('exportPdfBtn');
            const pdfOptions = document.getElementById('pdfOptions');
            const confirmExportPdf = document.getElementById('confirmExportPdf');
            const cancelExportPdf = document.getElementById('cancelExportPdf');
            
            exportPdfBtn.addEventListener('click', function() {
                pdfOptions.style.display = 'block';
            });
            
            cancelExportPdf.addEventListener('click', function() {
                pdfOptions.style.display = 'none';
            });
            
            confirmExportPdf.addEventListener('click', function() {
                const orientation = document.querySelector('input[name="pageOrientation"]:checked').value;
                exportToPDF(orientation);
                pdfOptions.style.display = 'none';
            });
            
            function exportToPDF(orientation = 'portrait') {
                // ·∫®n c√°c n√∫t khi xu·∫•t PDF
                const noPrintElements = document.querySelectorAll('.no-print');
                noPrintElements.forEach(el => {
                    el.style.display = 'none';
                });
                
                // T·∫°o PDF m·ªõi
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: orientation,
                    unit: 'mm',
                    format: 'a4'
                });
                
                // L·∫•y n·ªôi dung HTML ƒë·ªÉ chuy·ªÉn ƒë·ªïi
                const element = document.getElementById('contentToPrint');
                
                // S·ª≠ d·ª•ng html2canvas ƒë·ªÉ ch·ª•p n·ªôi dung
                html2canvas(element, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    width: element.scrollWidth,
                    height: element.scrollHeight
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    
                    // T√≠nh to√°n k√≠ch th∆∞·ªõc cho PDF
                    const imgWidth = doc.internal.pageSize.getWidth();
                    const pageHeight = doc.internal.pageSize.getHeight();
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    let heightLeft = imgHeight;
                    let position = 0;
                    
                    // Th√™m trang ƒë·∫ßu ti√™n
                    doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                    
                    // Th√™m c√°c trang ti·∫øp theo n·∫øu n·ªôi dung qu√° d√†i
                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight;
                        doc.addPage();
                        doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }
                    
                    // L∆∞u file PDF
                    doc.save('Bien-ban-nhan-hang.pdf');
                    
                    // Hi·ªÉn th·ªã l·∫°i c√°c n√∫t sau khi xu·∫•t PDF
                    noPrintElements.forEach(el => {
                        el.style.display = '';
                    });
                });
            }
            
            // X·ª≠ l√Ω in bi√™n b·∫£n
            document.getElementById('printBtn').addEventListener('click', function() {
                window.print();
            });
            
            // X·ª≠ l√Ω l√†m m·ªõi form
            document.getElementById('resetBtn').addEventListener('click', function() {
                if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën l√†m m·ªõi bi√™n b·∫£n? T·∫•t c·∫£ d·ªØ li·ªáu ch∆∞a l∆∞u s·∫Ω b·ªã m·∫•t.')) {
                    document.querySelectorAll('input, select, textarea').forEach(element => {
                        if (element.id !== 'receivingPlace') {
                            element.value = '';
                        }
                    });
                    
                    // X√≥a t·∫•t c·∫£ s·∫£n ph·∫©m
                    productTableBody.innerHTML = '';
                    productCount = 0;
                    
                    // Reset ng√†y v√† gi·ªù v·ªÅ hi·ªán t·∫°i
                    const now = new Date();
                    document.getElementById('receivingDate').valueAsDate = now;
                    document.getElementById('receivingTime').value = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                    
                    // ƒê·ªìng b·ªô l√™n Firebase
                    saveDataToFirebase();
                }
            });
            
            // Thi·∫øt l·∫≠p ng√†y v√† gi·ªù m·∫∑c ƒë·ªãnh
            const now = new Date();
            document.getElementById('receivingDate').valueAsDate = now;
            document.getElementById('receivingTime').value = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            // T·ª± ƒë·ªông l∆∞u khi c√≥ thay ƒë·ªïi
            document.querySelectorAll('input, select, textarea').forEach(element => {
                element.addEventListener('change', function() {
                    saveDataToFirebase();
                });
            });
        });
    </script>
</body>
</html>
